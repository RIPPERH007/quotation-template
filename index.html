// Generate filename
const quoteNumber = document.querySelector('.quote-info .editable').textContent || 'QT-001';
const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
const filename = `Quotation_${quoteNumber.replace(/[^a-zA-Z0-9]/g, '_')}_${today}.pdf`;

// Show loading message
showMessage('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...', 'info');        // Initialize
document.addEventListener('DOMContentLoaded', function() {
calculateTotal();
});<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ - Quotation Template</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Sarabun', 'Tahoma', Arial, sans-serif;
line-height: 1.3;
color: #333;
background: #f4f6f9;
padding: 10px;
font-size: 13px;
}

.quotation-container {
max-width: 800px;
margin: 0 auto;
background: white;
box-shadow: 0 0 15px rgba(0,0,0,0.1);
border-radius: 8px;
overflow: hidden;
}

.header-section {
text-align: center;
padding: 15px 20px;
background: linear-gradient(135deg, #f8f9fa, #e9ecef);
border-bottom: 3px solid #3498db;
}

.thank-you {
font-size: 12px;
color: #666;
margin-bottom: 15px;
}

.quotation-title {
background: linear-gradient(135deg, #e74c3c, #c0392b);
color: white;
padding: 8px 20px;
font-size: 28px;
font-weight: bold;
letter-spacing: 2px;
margin: 0 -20px;
}

.content {
padding: 20px;
}

.quote-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 20px;
gap: 20px;
}

.vendor-info {
font-size: 13px;
line-height: 1.4;
text-align: left;
flex: 1;
}

.vendor-info div {
margin-bottom: 3px;
}

.quote-info {
text-align: right;
font-size: 13px;
flex: 1;
}

.quote-info div {
margin-bottom: 5px;
}

.quote-info strong {
display: inline-block;
width: 80px;
}

.editable {
background: #f8f9fa;
border: 1px dashed #bdc3c7;
padding: 4px 8px;
margin: 2px 0;
border-radius: 3px;
min-height: 18px;
transition: all 0.3s ease;
display: inline-block;
min-width: 100px;
cursor: text;
}

.editable:hover {
background: #ecf0f1;
border-color: #3498db;
}

.editable:focus {
outline: none;
background: white;
border-color: #3498db;
border-style: solid;
box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
}

.customer-project-section {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
margin-bottom: 15px;
border: 1px solid #ddd;
}

.customer-info, .project-info {
padding: 15px;
}

.customer-info {
border-right: 1px solid #ddd;
}

.section-title {
font-weight: bold;
color: #2c3e50;
margin-bottom: 10px;
font-size: 14px;
}

.info-row {
margin-bottom: 8px;
font-size: 13px;
}

.info-label {
font-weight: bold;
color: #34495e;
display: inline-block;
width: 120px;
}

.items-table {
width: 100%;
border-collapse: collapse;
margin: 15px 0;
font-size: 11px;
border: 1px solid #ddd;
}

.items-table th {
background: #34495e;
color: white;
padding: 8px 6px;
text-align: center;
font-weight: bold;
font-size: 11px;
border: 1px solid #ddd;
}

.items-table td {
padding: 6px;
border: 1px solid #ddd;
text-align: center;
vertical-align: top;
}

.items-table tr:nth-child(even) {
background: #f8f9fa;
}

.description-cell {
text-align: left !important;
max-width: 350px;
padding: 8px !important;
}

.description-cell .editable {
min-width: 100%;
white-space: pre-wrap;
font-size: 11px;
line-height: 1.3;
min-height: 40px;
}

.description-list {
margin-top: 5px;
padding-left: 10px;
}

.description-list .desc-item {
margin-bottom: 3px;
font-size: 11px;
position: relative;
}

.desc-item .editable {
min-width: 300px;
font-size: 11px;
line-height: 1.2;
border: 1px dashed #ccc;
padding: 2px 5px;
}

.desc-item .editable:hover {
border-color: #3498db;
background: #f0f8ff;
}

.desc-item .editable:focus {
border-color: #3498db;
background: white;
box-shadow: 0 0 3px rgba(52, 152, 219, 0.3);
}

.desc-item .remove-desc-btn {
background: #e74c3c;
color: white;
border: none;
padding: 2px 6px;
border-radius: 2px;
cursor: pointer;
font-size: 9px;
margin-left: 5px;
vertical-align: middle;
}

.desc-item .remove-desc-btn:hover {
background: #c0392b;
}

.add-desc-btn {
background: #27ae60;
color: white;
border: none;
padding: 4px 8px;
border-radius: 3px;
cursor: pointer;
font-size: 10px;
margin-top: 5px;
}

.add-desc-btn:hover {
background: #219a52;
}

.total-row {
background: #ecf0f1 !important;
font-weight: bold;
}

.total-row td {
padding: 10px !important;
border-top: 2px solid #34495e !important;
}

.payment-terms {
background: #f8f9fa;
padding: 12px;
border: 1px solid #ddd;
margin: 15px 0;
}

.payment-terms-title {
font-weight: bold;
color: #2c3e50;
margin-bottom: 10px;
font-size: 14px;
}

.payment-terms .editable {
width: 100%;
min-height: 60px;
white-space: pre-wrap;
}

.signature-section {
display: flex;
justify-content: space-between;
margin-top: 30px;
padding-top: 20px;
}

.signature-box {
text-align: center;
width: 200px;
}

.signature-line {
border-top: 1px solid #333;
margin: 40px 0 10px 0;
}

.button-container {
display: flex;
flex-wrap: wrap;
gap: 10px;
margin: 20px 0;
justify-content: center;
}

.btn {
padding: 10px 20px;
border: none;
border-radius: 5px;
cursor: pointer;
font-size: 14px;
font-weight: bold;
transition: all 0.3s ease;
color: white;
}

.btn:hover {
transform: translateY(-1px);
box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.btn-primary {
background: #3498db;
}

.btn-danger {
background: #e74c3c;
}

.btn-success {
background: #27ae60;
}

.remove-btn {
background: #e74c3c;
color: white;
border: none;
padding: 4px 8px;
border-radius: 3px;
cursor: pointer;
font-size: 10px;
}

.remove-btn:hover {
background: #c0392b;
}

@media print {
body {
background: white !important;
padding: 0 !important;
font-size: 12px !important;
margin: 0 !important;
}

.quotation-container {
box-shadow: none !important;
border-radius: 0 !important;
max-width: none !important;
margin: 0 !important;
width: 100% !important;
}

.btn, .remove-btn, .button-container {
display: none !important;
}

.editable {
border: none !important;
background: transparent !important;
padding: 2px !important;
box-shadow: none !important;
}

.editable:hover,
.editable:focus {
background: transparent !important;
border: none !important;
box-shadow: none !important;
}

.quotation-title {
margin: 0 !important;
background: #e74c3c !important;
-webkit-print-color-adjust: exact !important;
color-adjust: exact !important;
}

.header-section {
background: #f8f9fa !important;
-webkit-print-color-adjust: exact !important;
color-adjust: exact !important;
}

.items-table th {
background: #34495e !important;
color: white !important;
-webkit-print-color-adjust: exact !important;
color-adjust: exact !important;
}

.total-row {
background: #ecf0f1 !important;
-webkit-print-color-adjust: exact !important;
color-adjust: exact !important;
}

.payment-terms {
background: #f8f9fa !important;
-webkit-print-color-adjust: exact !important;
color-adjust: exact !important;
}

@page {
margin: 15mm;
size: A4;
}

.customer-project-section {
break-inside: avoid;
page-break-inside: avoid;
}

.items-table {
break-inside: avoid;
page-break-inside: avoid;
}

.items-table th,
.items-table td {
font-size: 11px !important;
padding: 6px 4px !important;
border: 1px solid #333 !important;
}

.description-cell .editable {
font-size: 10px !important;
}

.description-list div {
font-size: 10px !important;
}

/* Hide any tooltips or floating elements */
[title]:after,
.tooltip,
.hover-text {
display: none !important;
}
}

@media (max-width: 768px) {
body {
padding: 5px;
font-size: 12px;
}

.content {
padding: 15px;
}

.customer-project-section {
grid-template-columns: 1fr;
}

.customer-info {
border-right: none;
border-bottom: 1px solid #ddd;
}

.quote-header {
flex-direction: column;
gap: 10px;
}

.quote-info {
text-align: left;
}

.items-table {
font-size: 10px;
}

.items-table th,
.items-table td {
padding: 4px 2px;
}

.quotation-title {
font-size: 20px;
padding: 6px 15px;
margin: 0 -15px;
}

.signature-section {
flex-direction: column;
gap: 20px;
}

.info-label {
width: 100px;
}
}

@media (max-width: 480px) {
.quotation-title {
font-size: 18px;
letter-spacing: 1px;
}

.items-table th,
.items-table td {
font-size: 9px;
padding: 3px 1px;
}

.description-cell .editable {
font-size: 9px;
}
}
</style>
</head>
<body>
<div class="quotation-container">
<div class="header-section">
<div class="thank-you">‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ / Thank you for your business</div>
<div class="quotation-title">QUOTATION</div>
</div>

<div class="content">
<div class="quote-header">
<div class="vendor-info">
    <div><div class="editable" contenteditable="true">‡∏ô‡∏≤‡∏¢‡∏†‡∏Ñ‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏Ç‡∏≤‡∏ß‡∏ô‡∏¥‡∏•</div></div>
    <div><div class="editable" contenteditable="true">45/200 The Connect Rm.8</div></div>
    <div><div class="editable" contenteditable="true">‡πÄ‡∏Ç‡∏ï‡∏ö‡∏≤‡∏á‡πÄ‡∏Ç‡∏ô ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡πà‡∏≤‡πÅ‡∏£‡πâ‡∏á</div></div>
    <div><div class="editable" contenteditable="true">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£ 10220</div></div>
    <div>‡πÇ‡∏ó‡∏£: <div class="editable" contenteditable="true">(+66) 065-010-0040</div></div>
</div>
<div class="quote-info">
    <div><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> <div class="editable" contenteditable="true">QT-20250516-001</div></div>
    <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <div class="editable" contenteditable="true">16/05/2025</div></div>
    <div><strong>‡∏°‡∏µ‡∏ú‡∏•‡∏ñ‡∏∂‡∏á:</strong> <div class="editable" contenteditable="true">31/05/2025</div></div>
</div>
</div>

<div class="customer-project-section">
<div class="customer-info">
    <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / Customer Information</div>
    <div class="info-row">
        <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó / Company:</span><br>
        <div class="editable" contenteditable="true">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡πä‡∏≠‡∏ó ‡∏≠‡∏¥‡∏ó ‡πÇ‡∏ã‡∏•‡∏π‡∏ä‡∏±‡∏ô‡∏™‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î</div>
    </div>
    <div class="info-row">
        <span class="info-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / Address:</span><br>
        <div class="editable" contenteditable="true">225/708 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 11 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏´‡∏ß‡∏ô
‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏≤‡∏á‡∏î‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 50230</div>
    </div>
    <div class="info-row">
        <span class="info-label">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ / Tax ID:</span><br>
        <div class="editable" contenteditable="true">0505565016016</div>
    </div>
</div>

<div class="project-info">
    <div class="section-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / Project Details</div>
    <div class="info-row">
        <span class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ / Project:</span><br>
        <div class="editable" contenteditable="true">LockBox Kiosk</div>
    </div>
    <div class="info-row">
        <span class="info-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ / Timeline:</span><br>
        <div class="editable" contenteditable="true">15 ‡∏ß‡∏±‡∏ô</div>
    </div>
</div>
</div>

<table class="items-table" id="itemsTable">
<thead>
    <tr>
        <th style="width: 40px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö<br>No.</th>
        <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î<br>Description</th>
        <th style="width: 60px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô<br>Qty</th>
        <th style="width: 100px;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢<br>Unit Price</th>
        <th style="width: 100px;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô<br>Amount</th>
        <th style="width: 60px;">Action</th>
    </tr>
</thead>
<tbody id="itemsBody">
    <tr>
        <td>1</td>
        <td class="description-cell">
            <div class="editable" contenteditable="true">Leo Phase 2 (Back-end) (15 Day)</div>
            <div class="description-list">
                <div class="desc-item">
                    <div class="editable" contenteditable="true">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç api register ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö booking web ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">api ‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢ qr</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">api ‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢ ksher</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">api ‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢ edc</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö query ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ mobile app</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö query ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ kiosk</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö query ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ MainWeb</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <div class="desc-item">
                    <div class="editable" contenteditable="true">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ monitor ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
                    <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
                </div>
                <button class="add-desc-btn" onclick="addDescItem(this)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
            </div>
        </td>
        <td><div class="editable" contenteditable="true" onkeyup="calculateRow(this)">1</div></td>
        <td><div class="editable" contenteditable="true" onkeyup="calculateRow(this)">18,000.00</div></td>
        <td class="amount-cell">18,000.00</td>
        <td><button class="remove-btn" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
    </tr>
</tbody>
<tfoot>
    <tr class="total-row">
        <td colspan="4" style="text-align: right; font-weight: bold;">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô / Total</td>
        <td style="font-weight: bold;"><span id="totalAmount">18,000.00</span></td>
        <td></td>
    </tr>
</tfoot>
</table>

<div class="button-container">
<button class="btn btn-primary" onclick="addRow()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
<button class="btn btn-danger" onclick="saveAsPDF()">üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>
<button class="btn btn-success" onclick="downloadAsHTML()">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î HTML</button>
</div>

<div class="payment-terms">
<div class="payment-terms-title">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô / Payment Terms</div>
<div class="editable" contenteditable="true">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Api Leo ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Ñ‡∏∑‡∏≠
1) ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ 50% (9,000 ‡∏ö‡∏≤‡∏ó)
2) ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 50% (9,000 ‡∏ö‡∏≤‡∏ó)</div>
</div>

<div class="signature-section">
<div class="signature-box">
    <div style="text-align: center;">......................................................................</div>
    <div style="text-align: center; margin-top: 10px;">(‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏Å‡πä‡∏≠‡∏ó ‡∏≠‡∏¥‡∏ó ‡πÇ‡∏ã‡∏•‡∏π‡∏ä‡∏±‡∏ô‡∏™‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î)</div>
    <div style="text-align: center;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà / Date: ........................................</div>
</div>

<div class="signature-box">
    <div style="text-align: center;">......................................................................</div>
    <div style="text-align: center; margin-top: 10px;">(‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ / Vendor)</div>
    <div style="text-align: center;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà / Date: ........................................</div>
</div>
</div>
</div>
</div>

<script>
let itemCounter = 1;

function addRow() {
itemCounter++;
const tbody = document.getElementById('itemsBody');
const newRow = tbody.insertRow();

            newRow.innerHTML = `
<td>${itemCounter}</td>
<td class="description-cell">
    <div class="editable" contenteditable="true">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</div>
    <div class="description-list">
        <div class="desc-item">
            <div class="editable" contenteditable="true">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô 1</div>
            <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
        </div>
        <div class="desc-item">
            <div class="editable" contenteditable="true">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô 2</div>
            <button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
        </div>
        <button class="add-desc-btn" onclick="addDescItem(this)">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
    </div>
</td>
<td><div class="editable" contenteditable="true" onkeyup="calculateRow(this)">1</div></td>
<td><div class="editable" contenteditable="true" onkeyup="calculateRow(this)">0.00</div></td>
<td class="amount-cell">0.00</td>
<td><button class="remove-btn" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
`;

updateRowNumbers();
calculateTotal();
}

function removeRow(button) {
const row = button.closest('tr');
row.remove();
updateRowNumbers();
calculateTotal();
}

function updateRowNumbers() {
const rows = document.querySelectorAll('#itemsBody tr');
rows.forEach((row, index) => {
row.cells[0].textContent = index + 1;
});
itemCounter = rows.length;
}

function calculateRow(element) {
const row = element.closest('tr');
const qty = parseFloat(row.cells[2].querySelector('.editable').textContent) || 0;
const unitPrice = parseFloat(row.cells[3].querySelector('.editable').textContent.replace(/,/g, '')) || 0;
const amount = qty * unitPrice;

row.cells[4].textContent = amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
calculateTotal();
}

function calculateTotal() {
const amountCells = document.querySelectorAll('.amount-cell');
let total = 0;

amountCells.forEach(cell => {
const value = parseFloat(cell.textContent.replace(/,/g, '')) || 0;
total += value;
});

document.getElementById('totalAmount').textContent = total.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
}

// Save as PDF function - Real PDF generation
async function saveAsPDF() {
try {
// Load html2pdf library if not already loaded
if (typeof html2pdf === 'undefined') {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
    document.head.appendChild(script);
    
    await new Promise((resolve, reject) => {
        script.onload = resolve;
        script.onerror = reject;
    });
}

// Hide all interactive elements
const interactiveElements = document.querySelectorAll('.btn, .remove-btn, .button-container, .remove-desc-btn, .add-desc-btn');
const originalStates = [];

interactiveElements.forEach((element, index) => {
    originalStates[index] = element.style.display;
    element.style.display = 'none';
});

// Prepare container for PDF generation
const container = document.querySelector('.quotation-container');
const originalStyles = {
    maxWidth: container.style.maxWidth,
    margin: container.style.margin,
    padding: container.style.padding,
    boxShadow: container.style.boxShadow,
    borderRadius: container.style.borderRadius
};

// Optimize for PDF
container.style.maxWidth = '190mm';
container.style.margin = '0';
container.style.padding = '0';
container.style.boxShadow = 'none';
container.style.borderRadius = '0';
container.style.backgroundColor = 'white';

// Optimize content for single page
const content = container.querySelector('.content');
const originalContentStyle = content.style.cssText;
content.style.padding = '15px';
content.style.fontSize = '11px';

// Optimize table for PDF
const table = container.querySelector('.items-table');
const originalTableStyle = table.style.cssText;
table.style.fontSize = '10px';
table.style.marginTop = '10px';
table.style.marginBottom = '10px';

// Optimize sections
const sections = container.querySelectorAll('.customer-project-section, .payment-terms');
const originalSectionStyles = [];
sections.forEach((section, index) => {
    originalSectionStyles[index] = section.style.cssText;
    section.style.marginTop = '10px';
    section.style.marginBottom = '10px';
    section.style.padding = '10px';
});

// Make description items smaller
const descItems = container.querySelectorAll('.desc-item .editable');
const originalDescStyles = [];
descItems.forEach((item, index) => {
    originalDescStyles[index] = item.style.cssText;
    item.style.fontSize = '9px';
    item.style.lineHeight = '1.2';
    item.style.marginBottom = '2px';
});

// Convert all editable elements to plain text
const editables = document.querySelectorAll('.editable');
const editableStates = [];

editables.forEach((el, index) => {
    editableStates[index] = {
        contentEditable: el.contentEditable,
        style: el.style.cssText
    };
    
    el.contentEditable = 'false';
    el.style.border = 'none';
    el.style.background = 'transparent';
    el.style.padding = '0';
    el.style.cursor = 'default';
});

// Add dashes to description items for PDF
const descItems = document.querySelectorAll('.desc-item');
descItems.forEach(item => {
    const text = item.querySelector('.editable');
    if (text && !text.textContent.startsWith('-')) {
        text.textContent = '- ' + text.textContent;
    }
});

// Generate PDF
await html2pdf().set(options).from(container).save();

// Success message
showMessage('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');

// Restore all states
interactiveElements.forEach((element, index) => {
    element.style.display = originalStates[index];
});

// Restore container styles
container.style.maxWidth = originalStyles.maxWidth;
container.style.margin = originalStyles.margin;
container.style.padding = originalStyles.padding;
container.style.boxShadow = originalStyles.boxShadow;
container.style.borderRadius = originalStyles.borderRadius;
container.style.backgroundColor = '';

// Restore content
content.style.cssText = originalContentStyle;

// Restore table
table.style.cssText = originalTableStyle;

// Restore sections
sections.forEach((section, index) => {
    section.style.cssText = originalSectionStyles[index];
});

// Restore description items
descItems.forEach((item, index) => {
    if (originalDescStyles[index]) {
        item.style.cssText = originalDescStyles[index];
    }
});

editables.forEach((el, index) => {
    el.contentEditable = editableStates[index].contentEditable;
    el.style.cssText = editableStates[index].style;
});

// Remove dashes that were added for PDF
const descItemsAfter = document.querySelectorAll('.desc-item');
descItemsAfter.forEach(item => {
    const text = item.querySelector('.editable');
    if (text && text.textContent.startsWith('- ')) {
        text.textContent = text.textContent.substring(2);
    }
});

} catch (error) {
console.error('PDF generation error:', error);

// Fallback to print method
showMessage('‚ö†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Save as PDF"', 'info');

setTimeout(() => {
    // Hide elements for print
    const interactiveElements = document.querySelectorAll('.btn, .remove-btn, .button-container, .remove-desc-btn, .add-desc-btn');
    interactiveElements.forEach(el => el.style.display = 'none');
    
    // Print
    window.print();
    
    // Restore elements
    setTimeout(() => {
        interactiveElements.forEach(el => el.style.display = '');
    }, 1000);
}, 500);
}
}

// Download as HTML
function downloadAsHTML() {
const buttons = document.querySelectorAll('.btn, .remove-btn, .button-container');
buttons.forEach(btn => btn.style.display = 'none');

const htmlContent = `<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</title>
<style>${document.querySelector('style').textContent}</style>
</head>
<body>
${document.querySelector('.quotation-container').outerHTML}
</body>
</html>`;

const blob = new Blob([htmlContent], { type: 'text/html' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');

const quoteNumber = document.querySelector('.quote-info .editable').textContent || 'QT-001';
const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
a.download = `Quotation_${quoteNumber.replace(/[^a-zA-Z0-9]/g, '_')}_${today}.html`;
a.href = url;

document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);

buttons.forEach(btn => btn.style.display = '');
showMessage('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î HTML ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
}

// Show message function
function showMessage(message, type) {
const messageDiv = document.createElement('div');
messageDiv.style.cssText = `
position: fixed;
top: 20px;
right: 20px;
padding: 15px 20px;
border-radius: 8px;
color: white;
font-weight: bold;
z-index: 1000;
max-width: 350px;
animation: slideIn 0.3s ease;
background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
box-shadow: 0 4px 12px rgba(0,0,0,0.3);
`;
messageDiv.textContent = message;

const style = document.createElement('style');
style.textContent = `
@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
`;
if (!document.querySelector('style[data-animation]')) {
style.setAttribute('data-animation', 'true');
document.head.appendChild(style);
}

document.body.appendChild(messageDiv);

setTimeout(() => {
messageDiv.remove();
}, 4000);
}

// Add description item
function addDescItem(button) {
const descList = button.parentElement;
const newDescItem = document.createElement('div');
newDescItem.className = 'desc-item';
newDescItem.innerHTML = `
<div class="editable" contenteditable="true">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡∏°‡πà</div>
<button class="remove-desc-btn" onclick="removeDescItem(this)">√ó</button>
`;

descList.insertBefore(newDescItem, button);
}

// Remove description item
function removeDescItem(button) {
const descItem = button.parentElement;
descItem.remove();
}
</script>
</body>
</html>